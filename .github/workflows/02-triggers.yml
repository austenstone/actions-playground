name: 02. Workflow Triggers

# Workflow triggers are events that cause a workflow to run.
# There are 30+ triggers for all kinds of GitHub events.
# See: https://docs.github.com/en/actions/reference/workflows-and-actions/events-that-trigger-workflows
on:
  # Trigger on git push events
  push:
    # Branch filters
    branches:
      - main # main branch
      - "release/v[0-9].[0-9]" # release/v1.0, release/v2.1, etc.
      - "feature/*" # Any feature branch
      - "!experimental" # Exclude experimental branch

    # Path filters
    paths:
      - "src/**" # Any file in src/ and subdirectories
      - "docs/*.md" # Markdown files in docs/ only
      - "**.js" # JavaScript files anywhere
      - "!src/test/**" # Exclude test files
      - "config/[a-z]*.yml" # YAML files starting with lowercase letter
      - ".github/workflows/**" # Any workflow file changes

    # Tag filters
    tags:
      - "v[0-9]+.[0-9]+.[0-9]+" # Semantic version tags
      - "!*-alpha" # Exclude alpha tags

  # Trigger on pull requests targeting main
  pull_request:
    branches: [main]
    types: [opened, synchronize, reopened]

  # Trigger on pull request reviews
  pull_request_review:
    types: [submitted]

  # Trigger on issues
  issues:
    types: [opened, labeled]

  # Trigger on issue comments
  issue_comment:
    types: [created]

  # Trigger on releases
  release:
    types: [published, created]

  # Trigger on a schedule (cron syntax)
  schedule:
    - cron: "0 0 * * *" # Daily at midnight UTC
    - cron: "0 12 * * MON" # Every Monday at noon UTC

  # Trigger manually from the GitHub UI
  workflow_dispatch:
    inputs:
      environment:
        description: "Target environment"
        required: true
        default: "staging"
        type: choice
        options:
          - staging
          - production
      debug:
        description: "Enable debug logging"
        required: false
        default: false
        type: boolean

jobs:
  # Demonstrate trigger types
  show-trigger-info:
    name: Show Trigger Information
    runs-on: ubuntu-latest
    
    steps:
      - name: Event information
        run: |
          echo "Event: ${{ github.event_name }}"
          echo "Ref: ${{ github.ref }}"
          echo "Actor: ${{ github.actor }}"
          echo "Repository: ${{ github.repository }}"
      
      - name: Push trigger info
        if: github.event_name == 'push'
        run: |
          echo "Commit SHA: ${{ github.sha }}"
          echo "Commit message: ${{ github.event.head_commit.message }}"
          echo "Branch: ${{ github.ref_name }}"
      
      - name: Pull request info
        if: github.event_name == 'pull_request'
        run: |
          echo "PR number: ${{ github.event.pull_request.number }}"
          echo "PR title: ${{ github.event.pull_request.title }}"
          echo "PR author: ${{ github.event.pull_request.user.login }}"
      
      - name: Manual trigger info
        if: github.event_name == 'workflow_dispatch'
        run: |
          echo "Environment: ${{ inputs.environment }}"
          echo "Debug mode: ${{ inputs.debug }}"
      
      - name: Schedule trigger info
        if: github.event_name == 'schedule'
        run: echo "Scheduled workflow run at $(date)"

  # Path filtering example
  path-based-jobs:
    name: Path-Based Execution
    runs-on: ubuntu-latest
    if: github.event_name == 'push'
    
    steps:
      - uses: actions/checkout@v5
      
      - name: Check changed files
        id: changes
        uses: dorny/paths-filter@v3
        with:
          filters: |
            src:
              - 'src/**'
            docs:
              - 'docs/**'
              - '*.md'
      
      - name: Build if source changed
        if: steps.changes.outputs.src == 'true'
        run: echo "Building application..."
      
      - name: Update docs if docs changed
        if: steps.changes.outputs.docs == 'true'
        run: echo "Updating documentation..."

  # Branch-based workflow
  branch-workflows:
    name: Branch-Specific Job
    runs-on: ubuntu-latest
    if: github.event_name == 'push'
    
    steps:
      - name: Main branch workflow
        if: github.ref == 'refs/heads/main'
        run: echo "Running on main branch - deploy to production"
      
      - name: Feature branch workflow
        if: startsWith(github.ref, 'refs/heads/feature/')
        run: echo "Running on feature branch - run tests"
      
      - name: Release branch workflow
        if: startsWith(github.ref, 'refs/heads/release/')
        run: echo "Running on release branch - create release candidate"