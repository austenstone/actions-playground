name: 06. Expressions

# Expressions: ${{ ... }} - Programmatically evaluate values
# Use for: accessing contexts, calling functions, conditional logic

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
  workflow_dispatch:

jobs:
  # Literals & Basic Syntax
  literals:
    name: Literals & Basic Syntax
    runs-on: ubuntu-latest
    
    steps:
      - name: Data Types
        run: |
          echo "String: ${{ 'Hello World' }}"
          echo "Number: ${{ 42 }}"
          echo "Float: ${{ 3.14 }}"
          echo "Boolean: ${{ true }}"
          echo "Null: ${{ null }}"
          echo "Hex: ${{ 0xFF }}"
          echo "Scientific: ${{ 1.5e3 }}"

  # Operators
  operators:
    name: Operators
    runs-on: ubuntu-latest
    
    steps:
      - name: Comparison Operators
        run: |
          echo "Equal: ${{ 5 == 5 }}"
          echo "Not equal: ${{ 5 != 3 }}"
          echo "Greater: ${{ 10 > 5 }}"
          echo "Less: ${{ 3 < 7 }}"
          echo "Greater/equal: ${{ 5 >= 5 }}"
          echo "Less/equal: ${{ 3 <= 7 }}"
      
      - name: Logical Operators
        run: |
          echo "AND: ${{ true && true }}"
          echo "OR: ${{ false || true }}"
          echo "NOT: ${{ !false }}"
      
      - name: Ternary Pattern
        env:
          ENV: ${{ github.ref == 'refs/heads/main' && 'production' || 'development' }}
        run: |
          echo "Environment: $ENV"

  # Functions
  functions:
    name: Built-in Functions
    runs-on: ubuntu-latest
    
    steps:
      - name: String Functions
        run: |
          echo "contains: ${{ contains('hello world', 'world') }}"
          echo "startsWith: ${{ startsWith('hello', 'hel') }}"
          echo "endsWith: ${{ endsWith('hello', 'lo') }}"
          echo "format: ${{ format('Hello {0}!', 'World') }}"
      
      - name: Always run
        if: always()
        run: echo "always() - Always runs"
      - name: Run on Success
        if: success()
        run: echo "success() - Runs when successful"
      - name: Run on Failure
        if: failure()
        run: echo "failure() - Runs when failed"
      - name: Run on Cancelled
        if: cancelled()
        run: echo "cancelled() - Runs when cancelled"

      - name: JSON Functions
        run: |
          echo "toJSON: ${{ toJSON(github.event_name) }}"
          echo "fromJSON: ${{ fromJSON('{"key": "value"}').key }}"
      
      - name: Hash Function
        run: |
          echo "Hash of workflows: ${{ hashFiles('**/*.yml') }}"

  # Conditionals
  conditionals:
    name: Conditional Execution
    runs-on: ubuntu-latest
    
    steps:
      - name: Event-Based
        if: github.event_name == 'push'
        run: echo "✓ Push event"
      
      - name: Branch-Based
        if: github.ref == 'refs/heads/main'
        run: echo "✓ Main branch"
      
      - name: Multiple Conditions
        if: github.event_name == 'push' && github.ref == 'refs/heads/main'
        run: echo "✓ Push to main"
      
      - name: Pattern Matching
        if: contains(github.event.head_commit.message, '[skip ci]')
        run: echo "✓ Skip CI detected"
      
      - name: Complex Logic
        if: |
          (github.event_name == 'push' && github.ref == 'refs/heads/main') ||
          (github.event_name == 'workflow_dispatch')
        run: echo "✓ Complex condition met"

  # Context Access
  context-access:
    name: Context Access
    runs-on: ubuntu-latest
    
    steps:
      - name: GitHub Context
        run: |
          echo "Actor: ${{ github.actor }}"
          echo "Repo: ${{ github.repository }}"
          echo "Event: ${{ github.event_name }}"
          echo "Ref: ${{ github.ref_name }}"
      
      - name: Runner Context
        run: |
          echo "OS: ${{ runner.os }}"
          echo "Arch: ${{ runner.arch }}"
      
      - name: Step Outputs
        id: demo
        run: echo "result=success" >> $GITHUB_OUTPUT
      
      - name: Use Step Output
        run: |
          echo "Previous: ${{ steps.demo.outputs.result }}"

  # =====================================
  # Common Patterns
  # =====================================
  patterns:
    name: Common Patterns
    runs-on: ubuntu-latest
    
    steps:
      - name: Default Value
        env:
          VALUE: ${{ github.event.inputs.value || 'default' }}
        run: |
          echo "Value: $VALUE"
      
      - name: Conditional Environment
        env:
          DEPLOY_ENV: ${{ github.ref == 'refs/heads/main' && 'prod' || 'dev' }}
        run: |
          echo "Deploying to: $DEPLOY_ENV"
      
      - name: Dynamic Job Name
        run: |
          echo "Running job: ${{ github.job }}"
      
      - name: Array Contains
        if: contains(fromJSON('["dev", "staging", "prod"]'), 'staging')
        run: echo "✓ Valid environment"