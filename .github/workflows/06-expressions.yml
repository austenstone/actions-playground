name: 06. Expressions

# Expressions: ${{ ... }} - Evaluate values programmatically
# Access contexts, use functions, perform operations, make decisions

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
  workflow_dispatch:

env:
  WORKFLOW_VAR: 'Workflow level'

jobs:
  # =====================================
  # Literals & Basic Syntax
  # =====================================
  literals:
    name: Literals & Basic Syntax
    runs-on: ubuntu-latest
    
    steps:
      - name: Literal Types
        env:
          NULL_VAL: ${{ null }}
          BOOL_VAL: ${{ false }}
          INT_VAL: ${{ 42 }}
          FLOAT_VAL: ${{ 3.14 }}
          HEX_VAL: ${{ 0xFF }}
          EXP_VAL: ${{ 1.5e3 }}
          STRING_VAL: ${{ 'Hello World' }}
          QUOTED_VAL: ${{ 'It''s escaped!' }}
        run: |
          echo "Null: $NULL_VAL"
          echo "Boolean: $BOOL_VAL"
          echo "Integer: $INT_VAL"
          echo "Float: $FLOAT_VAL"
          echo "Hex: $HEX_VAL"
          echo "Exponential: $EXP_VAL"
          echo "String: $STRING_VAL"
          echo "Quoted: $QUOTED_VAL"

  # =====================================
  # Context Access
  # =====================================
  contexts:
    name: Context Access
    runs-on: ubuntu-latest
    
    steps:
      - name: GitHub Context
        run: |
          echo "Actor: ${{ github.actor }}"
          echo "Repo: ${{ github.repository }}"
          echo "Branch: ${{ github.ref_name }}"
          echo "SHA: ${{ github.sha }}"
          echo "Event: ${{ github.event_name }}"
          echo "Run #: ${{ github.run_number }}"
      
      - name: Runner Context
        run: |
          echo "OS: ${{ runner.os }}"
          echo "Arch: ${{ runner.arch }}"
          echo "Name: ${{ runner.name }}"
          echo "Temp: ${{ runner.temp }}"
      
      - name: Job Context
        run: echo "Status: ${{ job.status }}"
      
      - name: Step Outputs
        id: demo
        run: echo "result=success" >> $GITHUB_OUTPUT
      
      - name: Access Step Output
        run: echo "Previous step: ${{ steps.demo.outputs.result }}"

  # =====================================
  # Operators
  # =====================================
  operators:
    name: Operators
    runs-on: ubuntu-latest
    
    steps:
      - name: Comparison Operators
        run: |
          echo "Equal: ${{ 5 == 5 }}"
          echo "Not equal: ${{ 5 != 3 }}"
          echo "Greater: ${{ 10 > 5 }}"
          echo "Less: ${{ 3 < 7 }}"
          echo "Greater or equal: ${{ 5 >= 5 }}"
          echo "Less or equal: ${{ 3 <= 7 }}"
      
      - name: Logical Operators
        run: |
          echo "AND: ${{ true && true }}"
          echo "OR: ${{ false || true }}"
          echo "NOT: ${{ !false }}"
      
      - name: Ternary Pattern
        env:
          RESULT: ${{ github.ref == 'refs/heads/main' && 'production' || 'development' }}
        run: echo "Environment: $RESULT"

  # =====================================
  # Functions
  # =====================================
  functions:
    name: Built-in Functions
    runs-on: ubuntu-latest
    
    steps:
      - name: String Functions
        run: |
          echo "Contains: ${{ contains('hello world', 'world') }}"
          echo "StartsWith: ${{ startsWith('hello', 'hel') }}"
          echo "EndsWith: ${{ endsWith('hello', 'lo') }}"
          echo "Format: ${{ format('Hello {0}!', 'World') }}"
          echo "Join: ${{ join(github.event.commits.*.message, ', ') }}"
      
      - name: Status Functions
        if: always()
        run: |
          echo "always() - This always runs"
          echo "success() - Previous steps succeeded: ${{ success() }}"
          echo "failure() - Previous step failed: ${{ failure() }}"
          echo "cancelled() - Workflow cancelled: ${{ cancelled() }}"
      
      - name: Type Conversion
        run: |
          echo "toJSON: ${{ toJSON(github.event) }}"
          echo "fromJSON: ${{ fromJSON('{"key": "value"}').key }}"
      
      - name: Hash Files
        run: |
          echo "Hash: ${{ hashFiles('**/*.yml') }}"

  # =====================================
  # Conditionals
  # =====================================
  conditionals:
    name: Conditional Execution
    runs-on: ubuntu-latest
    
    steps:
      - name: Always Runs
        run: echo "This runs on all events"
      
      - name: Only on Push
        if: github.event_name == 'push'
        run: echo "Push event detected"
      
      - name: Only on Main
        if: github.ref == 'refs/heads/main'
        run: echo "Running on main branch"
      
      - name: Multiple Conditions
        if: github.event_name == 'push' && github.ref == 'refs/heads/main'
        run: echo "Push to main branch"
      
      - name: Pattern Matching
        if: contains(github.event.head_commit.message, '[skip ci]')
        run: echo "Skip CI detected in commit message"

  # =====================================
  # Array & Object Filtering
  # =====================================
  filtering:
    name: Array & Object Filtering
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request'
    
    steps:
      - name: PR Label Check
        if: contains(github.event.pull_request.labels.*.name, 'bug')
        run: echo "This PR has a bug label"
      
      - name: Array Contains
        if: contains(fromJSON('["dev", "staging", "prod"]'), 'staging')
        run: echo "Environment is valid"

  # =====================================
  # Context Dumping
  # =====================================
  dump-contexts:
    name: Dump All Contexts
    runs-on: ubuntu-latest
    
    steps:
      - name: All Contexts
        run: |
          echo "=== GitHub Context ===" 
          echo '${{ toJSON(github) }}'
          echo ""
          echo "=== Env Context ==="
          echo '${{ toJSON(env) }}'
          echo ""
          echo "=== Job Context ==="
          echo '${{ toJSON(job) }}'
          echo ""
          echo "=== Runner Context ==="
          echo '${{ toJSON(runner) }}'

  # =====================================
  # Common Patterns
  # =====================================
  patterns:
    name: Common Patterns
    runs-on: ubuntu-latest
    
    steps:
      - name: Default Value Pattern
        env:
          VALUE: ${{ github.event.inputs.value || 'default' }}
        run: echo "Value $VALUE"
      
      - name: Dynamic Job Name
        run: echo "Job ${{ github.job }}"
      
      - name: Conditional Env Var
        env:
          DEPLOY_ENV: ${{ github.ref == 'refs/heads/main' && 'production' || 'staging' }}
        run: echo "Deploying to $DEPLOY_ENV"
